# Обзор архитектуры PDFmanager

## Введение

PDFmanager - это Electron-приложение для обработки PDF файлов, включающее функции объединения, сжатия и генерации реестров. Приложение построено по модульной архитектуре с четким разделением ответственности между компонентами.

## Структура документации

- [Архитектура приложения](architecture.md) - Общая архитектура и слои приложения
- [Ядро приложения](core.md) - Компоненты ядра: StateManager, EventBus, Logger, Config
- [Сервисы](services.md) - Бизнес-логика: PDFService, FileService, UpdateService и др.
- [UI компоненты](ui.md) - Пользовательский интерфейс и компоненты
- [Утилиты](utils.md) - Вспомогательные функции и классы
- [Типы](types.md) - Определения TypeScript
- [Процессы Electron](electron-processes.md) - Main, Renderer, Preload процессы
- [IPC коммуникации](ipc.md) - Взаимодействие между процессами

## Архитектурные принципы

### Модульность
Приложение разделено на независимые модули, каждый из которых отвечает за определенную функциональность. Это позволяет:
- Легко поддерживать и тестировать код
- Независимо разрабатывать и обновлять компоненты
- Повторно использовать компоненты

### Четкое разделение ответственности
Каждый компонент имеет четко определенную ответственность:
- **UI слой** - отображение интерфейса и обработка пользовательского ввода
- **Контроллеры** - оркестрация взаимодействия между слоями
- **Состояние** - управление данными приложения
- **Сервисы** - бизнес-логика и операции
- **Утилиты** - вспомогательные функции

### Безопасность
- Renderer процесс изолирован от Node.js API
- Все IPC вызовы валидируются
- Пользовательский ввод проверяется перед обработкой
- Ограничения на доступ к файловой системе

### Типизация
- Полное покрытие TypeScript
- Строгая типизация всех компонентов
- Валидация типов на этапе компиляции

## Основные компоненты

### Ядро приложения
Центральные компоненты, обеспечивающие работу всего приложения:

- **StateManager** - централизованное управление состоянием
- **EventBus** - система событий для слабосвязанного взаимодействия
- **Logger** - система логирования
- **Config** - управление конфигурацией

### Сервисы
Компоненты, реализующие бизнес-логику:

- **PDFService** - работа с PDF файлами (объединение, сжатие)
- **FileService** - операции с файловой системой
- **UpdateService** - управление обновлениями
- **SettingsService** - хранение и управление настройками
- **RegistryService** - генерация реестров

### IPC система
Механизм взаимодействия между процессами:

- Безопасная передача данных между Main и Renderer процессами
- Валидация всех входных данных
- Строгая типизация каналов
- Обработка ошибок

## Потоки данных

### Обработка PDF файлов
```
Пользовательский интерфейс
         ↓ (IPC вызов)
Main процесс → PDFService → Обработка файла
         ↓ (результат)
Пользовательский интерфейс
```

### Управление состоянием
```
UI компоненты → EventBus → StateManager → Обновление UI
```

### IPC коммуникации
```
Renderer → (безопасный API) → Preload → Main → Результат
```

## Паттерны проектирования

- **Состояние (State Pattern)** - централизованное управление состоянием
- **Наблюдатель (Observer Pattern)** - система событий
- **Фасад (Facade Pattern)** - упрощение сложных подсистем
- **Стратегия (Strategy Pattern)** - выбор алгоритмов обработки

## Рекомендации по разработке

### При добавлении новой функциональности:
1. Определите, к какому слою она относится
2. Создайте соответствующий сервис или компонент
3. Добавьте типы и валидацию
4. Напишите тесты
5. Обновите документацию

### При изменении существующего кода:
1. Ознакомьтесь с архитектурой компонента
2. Сохраняйте разделение ответственности
3. Обновите типы при необходимости
4. Убедитесь в совместимости с существующим API

## Тестирование

- Модульные тесты для каждого компонента
- Интеграционные тесты для взаимодействия между слоями
- E2E тесты для пользовательских сценариев
- Тесты безопасности для IPC каналов

## Безопасность

- Все пользовательские данные валидируются
- Ограничения на размер файлов и данных
- Защита от path traversal атак
- Санитизация пользовательского ввода